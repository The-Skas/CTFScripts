import pdb
from os.path import dirname, basename, isfile
import glob
import inspect, sys
import pkgutil
import importlib
"""
OH NO, DON'T LOOK AT ME! I'M SO UGLY!

Also don't touch or edit :D
Seriously, this is to make everyone else adding scripts easier. 
"""

modules = glob.glob(dirname(__file__)+"/*.py")
__all__ = [ basename(f)[:-3] for f in modules if isfile(f)]

#exploit_base_mod = __import__("exploit_base_c", fromlist=['Exploit'])

sub_modules = [cls for cls in __all__ if cls not in ['exploit_base_c', '__init__']]

base_exploit_class = None
def get_all_exploits():
	#First loop to make sure exploit_base is first in list
	
	for name, obj in inspect.getmembers(importlib.import_module("exploit_scripts.exploit_base")):
		if inspect.isclass(obj):
			base_exploit_class = obj


	exploit_sub_classes = list()
	for mod_name in sub_modules:
		for name, obj in inspect.getmembers(importlib.import_module("exploit_scripts."+mod_name)):
			if inspect.isclass(obj) and issubclass(obj, base_exploit_class) and obj != base_exploit_class:
				exploit_sub_classes.append(obj())

	return exploit_sub_classes

def get_exploit(service):
	all_exploits = get_all_exploits()

	#######
	# implement me first.
	#######
	for exploit in all_exploits:
		if exploit.get_port() == service['port']:
			return exploit

	return None

	

#ADD INTO ALL AFTER
__all__.append("get_all_exploits")
__all__.append("get_exploit")

	
